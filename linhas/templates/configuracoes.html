{% extends 'base.html' %}

{% block title %}Configurações - Gestor de Linhas{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1><i class="fas fa-cog"></i> Configurações</h1>
        <p class="text-muted">Gerencie configurações do sistema, usuários e associados</p>
    </div>
</div>

<!-- Abas de Navegação -->
<div class="card">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="linhas-tab" data-bs-toggle="tab" data-bs-target="#linhas-content" type="button" role="tab">
                    <i class="fas fa-phone me-2"></i>Linhas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios-content" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>Usuários
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="protocolo-tab" data-bs-toggle="tab" data-bs-target="#protocolo-content" type="button" role="tab">
                    <i class="fas fa-clipboard-list me-2"></i>Protocolos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="associados-tab" data-bs-toggle="tab" data-bs-target="#associados-content" type="button" role="tab">
                    <i class="fas fa-handshake me-2"></i>Associados
                </button>
            </li>
        </ul>
    </div>

    <div class="card-body">
        <div class="tab-content" id="configTabsContent">
            
            <!-- Aba Linhas -->
            <div class="tab-pane fade show active" id="linhas-content" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h5><i class="fas fa-phone text-primary"></i> Configurações de Linhas</h5>
                        <p class="text-muted">Configure parâmetros relacionados ao gerenciamento de linhas telefônicas</p>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Em desenvolvimento:</strong> Configurações de linhas serão implementadas em breve.
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-cogs"></i> Parâmetros Gerais</h6>
                                        <p class="small text-muted">Configurações globais do sistema de linhas</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-edit"></i> Configurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-chart-line"></i> Relatórios</h6>
                                        <p class="small text-muted">Configurações de relatórios e exportações</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-edit"></i> Configurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Usuários -->
            <div class="tab-pane fade" id="usuarios-content" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h5><i class="fas fa-users text-primary"></i> Gerenciamento de Usuários</h5>
                        <p class="text-muted">Gerencie usuários do sistema e segurança de acesso</p>
                        
                        <!-- Seção Desbloquear Usuários -->
                        <div class="card border-warning mb-4">
                            <div class="card-header bg-warning bg-opacity-10">
                                <h6 class="mb-0"><i class="fas fa-shield-alt"></i> Segurança e Bloqueios</h6>
                            </div>
                            <div class="card-body">
                                <p>Desbloquear manualmente usuários que excederam tentativas de login.</p>
                                
                                {% if bloqueados %}
                                    <div class="alert alert-warning">
                                        <strong><i class="fas fa-exclamation-triangle"></i> Usuários bloqueados atualmente:</strong>
                                        <ul class="mt-2 mb-0">
                                            {% for u in bloqueados %}
                                                <li class="fw-bold">{{ u }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% else %}
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle"></i> <em>Nenhum usuário bloqueado no momento.</em>
                                    </div>
                                {% endif %}
                                
                                <form method="post" action="{% url 'linhas:desbloquear_usuario' %}" class="row g-3">
                                    {% csrf_token %}
                                    <div class="col-md-8">
                                        <label for="unlockUsername" class="form-label">
                                            <i class="fas fa-user"></i> Nome de usuário
                                        </label>
                                        <input type="text" id="unlockUsername" name="username" class="form-control" placeholder="Digite o nome do usuário" required>
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button type="submit" class="btn btn-warning w-100">
                                            <i class="fas fa-unlock"></i> Desbloquear
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Formulário de Criação de Usuário -->
                        <div class="card border-success mb-4">
                            <div class="card-header bg-success bg-opacity-10">
                                <h6 class="mb-0"><i class="fas fa-user-plus"></i> Criar Novo Usuário</h6>
                            </div>
                            <div class="card-body">
                                <form id="createUserForm" method="post" action="{% url 'linhas:criar_usuario_empresa' %}" class="needs-validation" novalidate>
                                    {% csrf_token %}
                                    
                                    <!-- Área de Mensagens -->
                                    <div id="messageArea" class="alert alert-dismissible fade show d-none" role="alert">
                                        <span id="messageText"></span>
                                        <button type="button" class="btn-close" onclick="hideMessage()"></button>
                                    </div>
                                    
                                    <!-- Dados da Empresa -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-building"></i> Dados da Empresa
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="cnpj" class="form-label">
                                                <i class="fas fa-id-card"></i> CNPJ *
                                            </label>
                                            <input type="text" class="form-control" id="cnpj" name="cnpj" 
                                                   placeholder="00.000.000/0000-00" maxlength="18" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um CNPJ válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="razaoSocial" class="form-label">
                                                <i class="fas fa-building"></i> Razão Social *
                                            </label>
                                            <input type="text" class="form-control" id="razaoSocial" name="razao_social" 
                                                   placeholder="Nome da empresa" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira a razão social.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="nomeFantasia" class="form-label">
                                                <i class="fas fa-store"></i> Nome Fantasia
                                            </label>
                                            <input type="text" class="form-control" id="nomeFantasia" name="nome_fantasia" 
                                                   placeholder="Nome fantasia (opcional)">
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="endereco" class="form-label">
                                                <i class="fas fa-map-marker-alt"></i> Endereço *
                                            </label>
                                            <input type="text" class="form-control" id="endereco" name="endereco" 
                                                   placeholder="Endereço completo" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira o endereço.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dados de Contato -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-phone"></i> Dados de Contato
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">
                                                <i class="fas fa-envelope"></i> Email *
                                            </label>
                                            <input type="email" class="form-control" id="email" name="email" 
                                                   placeholder="email@empresa.com" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um email válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="telefone" class="form-label">
                                                <i class="fas fa-phone"></i> Contato Principal *
                                            </label>
                                            <input type="text" class="form-control" id="telefone" name="telefone" 
                                                   placeholder="(00) 00000-0000" maxlength="15" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um telefone válido.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dados do Agente -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-user"></i> Dados do Agente
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="cpfResponsavel" class="form-label">
                                                <i class="fas fa-id-badge"></i> CPF do Agente *
                                            </label>
                                            <input type="text" class="form-control" id="cpfResponsavel" name="cpf_responsavel" 
                                                   placeholder="000.000.000-00" maxlength="14" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um CPF válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="dataNascimento" class="form-label">
                                                <i class="fas fa-calendar"></i> Data de Nascimento *
                                            </label>
                                            <input type="date" class="form-control" id="dataNascimento" name="data_nascimento" required>
                                            <div class="invalid-feedback">
                                                Por favor, selecione a data de nascimento.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Configurações de Acesso -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-key"></i> Configurações de Acesso
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">
                                                <i class="fas fa-user"></i> Nome de Usuário *
                                            </label>
                                            <input type="text" class="form-control" id="username" name="username" 
                                                   placeholder="usuario.login" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um nome de usuário.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="senha" class="form-label">
                                                <i class="fas fa-lock"></i> Senha Inicial *
                                            </label>
                                            <input type="password" class="form-control" id="senha" name="senha" 
                                                   placeholder="Senha temporária" required>
                                            <div class="invalid-feedback">
                                                Por favor, defina uma senha inicial.
                                            </div>
                                        </div>
                                        
                                        <div class="col-12 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="isAdministrador" name="is_administrador">
                                                <label class="form-check-label" for="isAdministrador">
                                                    <i class="fas fa-shield-alt text-warning"></i> 
                                                    <strong>Usuário Administrador</strong>
                                                    <small class="text-muted d-block">Concede acesso total ao sistema</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Botões de Ação -->
                                    <div class="row">
                                        <div class="col-12 d-flex gap-2 justify-content-end">
                                            <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                                <i class="fas fa-times"></i> Cancelar
                                            </button>
                                            <button type="submit" class="btn btn-success">
                                                <i class="fas fa-save"></i> Criar Usuário
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Outras configurações de usuários -->
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-list"></i> Listar Usuários</h6>
                                        <p class="small text-muted">Visualizar todos os usuários cadastrados</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-eye"></i> Visualizar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-key"></i> Alterar Senhas</h6>
                                        <p class="small text-muted">Redefinir senhas de usuários</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-edit"></i> Gerenciar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Protocolos -->
            <div class="tab-pane fade" id="protocolo-content" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h5><i class="fas fa-clipboard-list text-primary"></i> Gerenciamento de Protocolos</h5>
                        <p class="text-muted">Configure parâmetros e gerencie protocolos do sistema</p>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Em desenvolvimento:</strong> Configurações avançadas de protocolos serão implementadas em breve.
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-cogs"></i> Parâmetros de Status</h6>
                                        <p class="small text-muted">Configurar status disponíveis para protocolos</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-edit"></i> Configurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-clock"></i> Prazos e SLA</h6>
                                        <p class="small text-muted">Definir prazos padrão de atendimento</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-calendar"></i> Definir
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-bell"></i> Notificações</h6>
                                        <p class="small text-muted">Configurar alertas automáticos</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-cog"></i> Configurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-archive"></i> Arquivamento</h6>
                                        <p class="small text-muted">Regras de arquivamento automático</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-folder"></i> Gerenciar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Associados -->
            <div class="tab-pane fade" id="associados-content" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h5><i class="fas fa-handshake text-primary"></i> Gerenciamento de Associados</h5>
                        <p class="text-muted">Configure e gerencie informações de associados e parcerias</p>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Em desenvolvimento:</strong> Funcionalidades de associados serão implementadas em breve.
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-building"></i> Cadastrar Associado</h6>
                                        <p class="small text-muted">Adicionar novos associados ao sistema</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-plus"></i> Novo Associado
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-list"></i> Listar Associados</h6>
                                        <p class="small text-muted">Visualizar todos os associados cadastrados</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-eye"></i> Visualizar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-percent"></i> Comissões</h6>
                                        <p class="small text-muted">Configurar percentuais de comissão</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-calculator"></i> Configurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-light">
                                    <div class="card-body">
                                        <h6><i class="fas fa-file-invoice-dollar"></i> Relatórios</h6>
                                        <p class="small text-muted">Relatórios de vendas por associado</p>
                                        <button class="btn btn-outline-primary btn-sm" disabled>
                                            <i class="fas fa-chart-bar"></i> Gerar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Máscaras de input
function aplicarMascaras() {
    // Máscara CNPJ
    const cnpjInput = document.getElementById('cnpj');
    if (cnpjInput) {
        cnpjInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    // Máscara CPF
    const cpfInput = document.getElementById('cpfResponsavel');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    // Máscara Telefone
    const telefoneInput = document.getElementById('telefone');
    if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    value = value.replace(/(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                }
            }
            e.target.value = value;
        });
    }
}

// Validações
function validarCNPJ(cnpj) {
    cnpj = cnpj.replace(/[^\d]/g, '');
    
    if (cnpj.length !== 14) return false;
    
    // Elimina CNPJs inválidos conhecidos
    if (/^(\d)\1+$/.test(cnpj)) return false;
    
    // Validação do primeiro dígito
    let soma = 0;
    let peso = 2;
    for (let i = 11; i >= 0; i--) {
        soma += parseInt(cnpj.charAt(i)) * peso;
        peso = peso === 9 ? 2 : peso + 1;
    }
    
    let digito = soma % 11;
    digito = digito < 2 ? 0 : 11 - digito;
    
    if (parseInt(cnpj.charAt(12)) !== digito) return false;
    
    // Validação do segundo dígito
    soma = 0;
    peso = 2;
    for (let i = 12; i >= 0; i--) {
        soma += parseInt(cnpj.charAt(i)) * peso;
        peso = peso === 9 ? 2 : peso + 1;
    }
    
    digito = soma % 11;
    digito = digito < 2 ? 0 : 11 - digito;
    
    return parseInt(cnpj.charAt(13)) === digito;
}

function validarCPF(cpf) {
    cpf = cpf.replace(/[^\d]/g, '');
    
    if (cpf.length !== 11) return false;
    
    // Elimina CPFs inválidos conhecidos
    if (/^(\d)\1+$/.test(cpf)) return false;
    
    // Validação do primeiro dígito
    let soma = 0;
    for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf.charAt(i)) * (10 - i);
    }
    let digito = (soma * 10) % 11;
    if (digito === 10) digito = 0;
    if (parseInt(cpf.charAt(9)) !== digito) return false;
    
    // Validação do segundo dígito
    soma = 0;
    for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf.charAt(i)) * (11 - i);
    }
    digito = (soma * 10) % 11;
    if (digito === 10) digito = 0;
    
    return parseInt(cpf.charAt(10)) === digito;
}

// Validação do formulário
function validarFormulario() {
    const form = document.getElementById('createUserForm');
    if (!form) return;

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        let isValid = true;
        
        // Validar CNPJ
        const cnpj = document.getElementById('cnpj').value;
        if (!validarCNPJ(cnpj)) {
            document.getElementById('cnpj').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('cnpj').classList.remove('is-invalid');
            document.getElementById('cnpj').classList.add('is-valid');
        }
        
        // Validar CPF
        const cpf = document.getElementById('cpfResponsavel').value;
        if (!validarCPF(cpf)) {
            document.getElementById('cpfResponsavel').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('cpfResponsavel').classList.remove('is-invalid');
            document.getElementById('cpfResponsavel').classList.add('is-valid');
        }
        
        // Validar campos obrigatórios
        const requiredFields = form.querySelectorAll('[required]');
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
            }
        });
        
        form.classList.add('was-validated');
        
        if (isValid) {
            // Enviar dados via AJAX
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message, 'success');
                    resetForm();
                } else {
                    showMessage(data.error || 'Erro ao criar usuário', 'error');
                }
            })
            .catch(error => {
                showMessage('Erro de conexão ao criar usuário', 'error');
                console.error('Error:', error);
            });
        }
    });
}

// Função para resetar o formulário
function resetForm() {
    const form = document.getElementById('createUserForm');
    if (form) {
        form.reset();
        form.classList.remove('was-validated');
        
        // Remover classes de validação
        const inputs = form.querySelectorAll('.form-control');
        inputs.forEach(input => {
            input.classList.remove('is-valid', 'is-invalid');
        });
        
        // Limpar checkbox
        const checkbox = document.getElementById('isAdministrador');
        if (checkbox) {
            checkbox.checked = false;
        }
    }
}

// Função para mostrar mensagens
function showMessage(message, type) {
    const messageArea = document.getElementById('messageArea');
    const messageText = document.getElementById('messageText');
    
    if (messageArea && messageText) {
        // Remover classes anteriores
        messageArea.className = 'alert alert-dismissible fade show';
        
        // Adicionar classe baseada no tipo
        if (type === 'success') {
            messageArea.classList.add('alert-success');
            messageText.innerHTML = '<i class="fas fa-check-circle"></i> ' + message;
        } else {
            messageArea.classList.add('alert-danger');
            messageText.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + message;
        }
        
        // Mostrar mensagem
        messageArea.classList.remove('d-none');
        
        // Auto-hide após 8 segundos para sucesso, manter erro
        if (type === 'success') {
            setTimeout(() => {
                hideMessage();
            }, 8000);
        }
    }
}

// Função para esconder mensagem
function hideMessage() {
    const messageArea = document.getElementById('messageArea');
    if (messageArea) {
        messageArea.classList.add('d-none');
    }
}

// Inicializar quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', function() {
    aplicarMascaras();
    validarFormulario();
});
</script>

{% endblock %}
