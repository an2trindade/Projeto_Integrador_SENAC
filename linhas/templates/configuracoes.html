{% extends 'base.html' %}

{% block title %}Configurações - Gestor de Linhas{% endblock %}

{% block extra_css %}
<style>
    /* Layout conforme print - fundo escuro */
    body {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 0;
    }
    
    /* Header principal - Tecnológico */
    .config-main-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        margin: 0;
        box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
    }
    
    .config-title {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .config-title i {
        font-size: 1.8rem;
    }
    
    .config-subtitle {
        opacity: 0.9;
        margin: 0.5rem 0 0 0;
        font-size: 1.1rem;
        font-weight: 400;
    }
    
    /* Container branco com abas */
    /* Container branco com abas */
    .config-white-container {
        background: white;
        margin: 0 2rem 2rem 2rem;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    /* Navegação das Abas - Sistema Claro */
    .config-nav {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        border-bottom: none;
        padding: 1.5rem 0;
        box-shadow: none;
    }
    
    .nav-tabs-custom {
        border: none;
        padding: 0 2rem;
        margin: 0;
        display: flex;
        gap: 12px;
    }
    
    .nav-tabs-custom .nav-link {
        margin-bottom: 0;
    }
    
    .nav-tabs-custom .nav-link.active {
        background-color: #0d6efd;
        border-color: #0d6efd;
        color: #fff;
    }
    
    .nav-tabs-custom .nav-link.active::after {
        display: none;
    }
    
    /* Conteúdo das Abas - Mais Separado */
    .tab-content-area {
        background: white;
        padding: 2rem;
        min-height: 500px;
        border-top: 1px solid #dee2e6;
        position: relative;
    }
    

    
    /* Títulos das Seções - Mais Destacados */
    .section-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 1rem;
        padding: 1.5rem 0;
        border-bottom: 3px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 1rem;
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        margin: -1.5rem -1.5rem 2rem -1.5rem;
        padding-left: 1.5rem;
        border-radius: 8px 8px 0 0;
    }
    
    .section-title i {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .section-description {
        color: #6c757d;
        margin-bottom: 2rem;
        font-size: 1rem;
        line-height: 1.5;
    }
    
    /* Badge de Status Simples */
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-badge.active {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .status-badge.development {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    


    /* Cards de funcionalidades conforme print */
    .config-card {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    
    .config-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .config-card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .config-card-description {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    /* Alert de desenvolvimento conforme print */
    .development-alert {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        color: #721c24;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .development-alert i {
        color: #721c24;
    }
    
    .feature-card.active {
        border-left: 4px solid #28a745;
        background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
    }
    
    .feature-card.development {
        border-left: 4px solid #ffc107;
        background: linear-gradient(135deg, #fffef8 0%, #fef9e7 100%);
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
    }
    
    /* Ícones Simples */
    .feature-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        font-size: 1.25rem;
        color: white;
    }
    
    .feature-icon.primary { background: #007bff; }
    .feature-icon.success { background: #28a745; }
    .feature-icon.warning { background: #ffc107; color: #212529; }
    .feature-icon.info { background: #17a2b8; }
    .feature-icon.danger { background: #dc3545; }
    
    .feature-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.75rem;
    }
    
    .feature-description {
        color: #6c757d;
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 1.5rem;
    }
    
    /* Botões Simples */
    .btn-clean {
        padding: 0.5rem 1.25rem;
        border-radius: 4px;
        font-weight: 500;
        font-size: 0.9rem;
        border: 1px solid;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }
    
    .btn-clean.primary {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    .btn-clean.primary:hover {
        background: #0056b3;
        border-color: #0056b3;
        color: white;
        text-decoration: none;
    }
    
    .btn-clean.success {
        background: #28a745;
        color: white;
        border-color: #28a745;
    }
    
    .btn-clean.success:hover {
        background: #1e7e34;
        border-color: #1e7e34;
        color: white;
        text-decoration: none;
    }
    
    .btn-clean.outline {
        background: white;
        color: #6c757d;
        border-color: #dee2e6;
    }
    
    .btn-clean.outline:hover {
        background: #f8f9fa;
        border-color: #adb5bd;
        color: #495057;
        text-decoration: none;
    }
    
    .btn-clean:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .btn-clean:disabled:hover {
        transform: none;
        box-shadow: none;
    }
    
    /* Alerts Modernos */
    .modern-alert {
        border-radius: 16px;
        padding: 1.5rem;
        margin: 2rem 0;
        border: 1px solid;
        position: relative;
        overflow: hidden;
    }
    
    .modern-alert::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
    }
    
    .modern-alert.info {
        background: #f0f9ff;
        border-color: #e0f2fe;
        color: #0c4a6e;
    }
    
    .modern-alert.info::before {
        background: #0ea5e9;
    }
    
    .modern-alert.success {
        background: #f0fdf4;
        border-color: #dcfce7;
        color: #14532d;
    }
    
    .modern-alert.success::before {
        background: #10b981;
    }
    
    .modern-alert.warning {
        background: #fffbeb;
        border-color: #fef3c7;
        color: #92400e;
    }
    
    .modern-alert.warning::before {
        background: #f59e0b;
    }
    
    .alert-content {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .alert-icon {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.875rem;
    }
    
    .alert-icon.info {
        background: #0ea5e9;
        color: white;
    }
    
    .alert-icon.success {
        background: #10b981;
        color: white;
    }
    
    .alert-icon.warning {
        background: #f59e0b;
        color: white;
    }
    
    .alert-text strong {
        display: block;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    /* Formulários Padronizados */
    .form-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid #e9ecef;
    }
    
    .form-section-header {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e9ecef;
    }
    
    .form-group-enhanced {
        margin-bottom: 1.5rem;
    }
    
    .form-label-enhanced {
        color: #495057;
        font-weight: 500;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .form-control-enhanced {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 12px 16px;
        transition: all 0.3s ease;
    }
    
    .form-control-enhanced:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
        .config-tabs {
            padding: 1rem 1rem 0;
        }
        
        .config-tabs .nav-link {
            padding: 10px 12px;
            font-size: 0.9rem;
            margin-right: 2px;
        }
        
        .tab-content {
            padding: 1.5rem 1rem;
        }
        
        .feature-card-header {
            flex-direction: column;
            text-align: center;
        }
        
        .feature-icon {
            margin-right: 0;
            margin-bottom: 1rem;
        }
        
        .quick-access-cards {
            padding: 1rem;
            margin: 1rem;
        }
    }
    
    /* Cards de Acesso Rápido */
    .quick-access-cards {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        padding: 2rem;
        margin: 2rem;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .quick-access-title {
        color: #ffffff;
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .quick-access-title i {
        color: #00bfae;
    }
    
    .menu-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 15px;
        padding: 25px 20px;
        text-decoration: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        height: 140px;
        cursor: pointer;
    }
    
    .menu-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .menu-card:hover::before {
        left: 100%;
    }
    
    .menu-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 45px rgba(102, 126, 234, 0.5);
        border-color: rgba(102, 126, 234, 0.6);
    }
    
    .menu-card-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 12px;
        transition: all 0.3s ease;
    }
    
    .menu-card:hover .menu-card-icon {
        transform: scale(1.15) rotate(5deg);
    }
    
    .menu-card-title {
        color: #ffffff;
        font-size: 1rem;
        font-weight: 600;
        margin: 0;
        text-align: center;
        transition: color 0.3s ease;
    }
    
    .menu-card:hover .menu-card-title {
        color: #00bfae;
    }
    
    .menu-card-description {
        color: rgba(255,255,255,0.6);
        font-size: 0.75rem;
        text-align: center;
        margin-top: 5px;
    }
    
    /* Cores específicas por card */
    .menu-card.linhas .menu-card-icon {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #ffffff;
    }
    
    .menu-card.protocolo .menu-card-icon {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: #ffffff;
    }
    
    .menu-card.relatorios .menu-card-icon {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: #ffffff;
    }
    
    .menu-card.configuracoes .menu-card-icon {
        background: linear-gradient(135deg, #43e97b, #38f9d7);
        color: #ffffff;
    }
    
    .menu-card.fidelidade .menu-card-icon {
        background: linear-gradient(135deg, #fa709a, #fee140);
        color: #ffffff;
    }
    
    .menu-card.nova-linha .menu-card-icon {
        background: linear-gradient(135deg, #11998e, #38ef7d);
        color: #ffffff;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header Principal -->
<div class="config-main-header">
    <h1 class="config-title">
        <i class="fas fa-cogs"></i>
        Configurações
    </h1>
    <p class="config-subtitle">Gerencie configurações do sistema, usuários e associados</p>
</div>

<!-- Menu de Navegação Rápida -->
<div class="container-fluid px-4 py-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
    <h4 class="mb-4" style="color: #2d3748; font-weight: 600;">
        <i class="fas fa-th-large me-2"></i>Áreas de Configuração
    </h4>
    <div class="row g-3">
        <div class="col-md-3">
            <div class="text-decoration-none" onclick="toggleUsuariosPanel()" style="cursor: pointer;">
                <div class="card h-100 border-0 shadow-sm" style="transition: all 0.3s ease; cursor: pointer; border: 2px solid #667eea !important;">
                    <div class="card-body text-center p-4">
                        <div class="mb-3" style="width: 70px; height: 70px; margin: 0 auto; border-radius: 15px; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                            <i class="fas fa-users fa-2x text-white"></i>
                        </div>
                        <h5 class="card-title mb-2" style="color: #2d3748; font-weight: 600;">Usuários</h5>
                        <p class="card-text text-muted small">Gerenciar usuários e controle de acesso</p>
                        <span class="badge bg-success">Ativo</span>
                        <div class="mt-2">
                            <small class="text-primary"><i class="fas fa-hand-pointer me-1"></i>Clique para abrir</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <a href="#linhas-content" class="text-decoration-none" onclick="document.getElementById('linhas-content').scrollIntoView({behavior: 'smooth'}); return false;">
                <div class="card h-100 border-0 shadow-sm" style="transition: all 0.3s ease; cursor: pointer;">
                    <div class="card-body text-center p-4">
                        <div class="mb-3" style="width: 70px; height: 70px; margin: 0 auto; border-radius: 15px; background: linear-gradient(135deg, #11998e, #38ef7d); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-phone fa-2x text-white"></i>
                        </div>
                        <h5 class="card-title mb-2" style="color: #2d3748; font-weight: 600;">Linhas</h5>
                        <p class="card-text text-muted small">Configurações de linhas telefônicas</p>
                        <span class="badge bg-warning">Em Desenvolvimento</span>
                    </div>
                </div>
            </a>
        </div>
        
        <div class="col-md-3">
            <a href="#protocolos-section" class="text-decoration-none" onclick="document.getElementById('protocolos-section').scrollIntoView({behavior: 'smooth'}); return false;">
                <div class="card h-100 border-0 shadow-sm" style="transition: all 0.3s ease; cursor: pointer;">
                    <div class="card-body text-center p-4">
                        <div class="mb-3" style="width: 70px; height: 70px; margin: 0 auto; border-radius: 15px; background: linear-gradient(135deg, #f093fb, #f5576c); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-clipboard-list fa-2x text-white"></i>
                        </div>
                        <h5 class="card-title mb-2" style="color: #2d3748; font-weight: 600;">Protocolos</h5>
                        <p class="card-text text-muted small">Gerenciamento de protocolos</p>
                        <span class="badge bg-warning">Em Desenvolvimento</span>
                    </div>
                </div>
            </a>
        </div>
        
        <div class="col-md-3">
            <a href="#associados-section" class="text-decoration-none" onclick="document.getElementById('associados-section').scrollIntoView({behavior: 'smooth'}); return false;">
                <div class="card h-100 border-0 shadow-sm" style="transition: all 0.3s ease; cursor: pointer;">
                    <div class="card-body text-center p-4">
                        <div class="mb-3" style="width: 70px; height: 70px; margin: 0 auto; border-radius: 15px; background: linear-gradient(135deg, #4facfe, #00f2fe); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-handshake fa-2x text-white"></i>
                        </div>
                        <h5 class="card-title mb-2" style="color: #2d3748; font-weight: 600;">Associados</h5>
                        <p class="card-text text-muted small">Gerenciar associados e parcerias</p>
                        <span class="badge bg-warning">Em Desenvolvimento</span>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
    
    .usuarios-panel {
        display: none;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        padding: 2rem;
        margin: 2rem 0;
        animation: slideDown 0.3s ease-out;
    }
    
    .usuarios-panel.active {
        display: block;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .management-nav {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    
    .management-nav .nav-btn {
        flex: 1;
        min-width: 200px;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }
    
    .management-nav .nav-btn:hover {
        border-color: #667eea;
        background: #f8f9ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .management-nav .nav-btn.active {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }
    
    .management-nav .nav-btn i {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .management-content {
        display: none;
        animation: fadeIn 0.3s ease-in;
    }
    
    .management-content.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>

<script>
function toggleUsuariosPanel() {
    const panel = document.getElementById('usuarios-panel');
    panel.classList.toggle('active');
    
    if (panel.classList.contains('active')) {
        setTimeout(() => {
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }
}

function showManagementSection(sectionId) {
    // Esconde todas as seções
    document.querySelectorAll('.management-content').forEach(el => {
        el.classList.remove('active');
    });
    
    // Remove active de todos os botões
    document.querySelectorAll('.management-nav .nav-btn').forEach(el => {
        el.classList.remove('active');
    });
    
    // Mostra a seção selecionada
    document.getElementById(sectionId).classList.add('active');
    
    // Marca o botão como ativo
    event.currentTarget.classList.add('active');
}
</script>

<!-- Painel de Gerenciamento de Usuários -->
<div id="usuarios-panel" class="usuarios-panel container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: #2d3748; font-weight: 700;">
            <i class="fas fa-users me-3" style="color: #667eea;"></i>
            Gerenciamento de Usuários
        </h2>
        <button onclick="toggleUsuariosPanel()" class="btn btn-outline-secondary">
            <i class="fas fa-times me-2"></i>Fechar
        </button>
    </div>
    
    <p class="text-muted mb-4">
        <i class="fas fa-info-circle me-2"></i>
        Gerencie usuários do sistema, controle de acesso e segurança.
    </p>
    
    <!-- Menu de Navegação -->
    <div class="management-nav">
        <div class="nav-btn active" onclick="showManagementSection('listar-usuarios-section')">
            <i class="fas fa-list text-primary"></i>
            <h6 class="mb-0 mt-2">Listar Usuários</h6>
            <small class="text-muted">Ver todos os usuários</small>
        </div>
        
        <div class="nav-btn" onclick="showManagementSection('criar-usuario-section')">
            <i class="fas fa-user-plus text-success"></i>
            <h6 class="mb-0 mt-2">Criar Usuário</h6>
            <small class="text-muted">Adicionar novo usuário</small>
        </div>
        
        <div class="nav-btn" onclick="showManagementSection('bloqueados-section')">
            <i class="fas fa-unlock-alt text-warning"></i>
            <h6 class="mb-0 mt-2">Usuários Bloqueados</h6>
            <small class="text-muted">Gerenciar bloqueios</small>
        </div>
        
        <div class="nav-btn" onclick="showManagementSection('senhas-section')">
            <i class="fas fa-key text-danger"></i>
            <h6 class="mb-0 mt-2">Alterar Senhas</h6>
            <small class="text-muted">Redefinir senhas</small>
        </div>
    </div>
    
    <!-- Seção: Listar Usuários -->
    <div id="listar-usuarios-section" class="management-content active">
        <div class="card border-0 shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>Lista de Usuários do Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h6 class="text-muted mb-0">Usuários cadastrados no sistema</h6>
                    </div>
                    <a href="{% url 'linhas:listar_usuarios_empresa' %}" class="btn btn-primary">
                        <i class="fas fa-external-link-alt me-2"></i>Ver Lista Completa
                    </a>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Informação:</strong> Clique em "Ver Lista Completa" para acessar a página com todos os usuários cadastrados, onde você pode visualizar detalhes, editar e gerenciar permissões.
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card bg-primary bg-opacity-10">
                            <div class="card-body text-center">
                                <i class="fas fa-users fa-3x text-primary mb-3"></i>
                                <h6 class="text-muted">Total de Usuários</h6>
                                <h3 class="text-primary">{{ total_usuarios|default:"N/A" }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-success bg-opacity-10">
                            <div class="card-body text-center">
                                <i class="fas fa-user-check fa-3x text-success mb-3"></i>
                                <h6 class="text-muted">Usuários Ativos</h6>
                                <h3 class="text-success">{{ usuarios_ativos|default:"N/A" }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-warning bg-opacity-10">
                            <div class="card-body text-center">
                                <i class="fas fa-user-shield fa-3x text-warning mb-3"></i>
                                <h6 class="text-muted">Administradores</h6>
                                <h3 class="text-warning">{{ administradores|default:"N/A" }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Seção: Criar Usuário -->
    <div id="criar-usuario-section" class="management-content">
        <div class="card border-0 shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #38ef7d, #11998e); color: white;">
                <h5 class="mb-0">
                    <i class="fas fa-user-plus me-2"></i>Criar Novo Usuário
                </h5>
            </div>
            <div class="card-body">
                <form id="createUserForm" method="post" action="{% url 'linhas:criar_usuario_empresa' %}" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <!-- Área de Mensagens -->
                    <div id="messageArea" class="alert alert-dismissible fade show d-none" role="alert">
                        <span id="messageText"></span>
                        <button type="button" class="btn-close" onclick="hideMessage()"></button>
                    </div>
                    
                    <!-- Dados da Empresa -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-building"></i> Dados da Empresa
                            </h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="cnpj" class="form-label">
                                <i class="fas fa-id-card"></i> CNPJ *
                            </label>
                            <input type="text" class="form-control" id="cnpj" name="cnpj" 
                                   placeholder="00.000.000/0000-00" maxlength="18" required>
                            <div class="invalid-feedback">
                                Por favor, insira um CNPJ válido.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="razaoSocial" class="form-label">
                                <i class="fas fa-building"></i> Razão Social *
                            </label>
                            <input type="text" class="form-control" id="razaoSocial" name="razao_social" 
                                   placeholder="Nome da empresa" required>
                            <div class="invalid-feedback">
                                Por favor, insira a razão social.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="nomeFantasia" class="form-label">
                                <i class="fas fa-store"></i> Nome Fantasia
                            </label>
                            <input type="text" class="form-control" id="nomeFantasia" name="nome_fantasia" 
                                   placeholder="Nome fantasia (opcional)">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="endereco" class="form-label">
                                <i class="fas fa-map-marker-alt"></i> Endereço *
                            </label>
                            <input type="text" class="form-control" id="endereco" name="endereco" 
                                   placeholder="Endereço completo" required>
                            <div class="invalid-feedback">
                                Por favor, insira o endereço.
                            </div>
                        </div>
                    </div>

                    <!-- Dados de Contato -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-phone"></i> Dados de Contato
                            </h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Email *
                            </label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   placeholder="email@empresa.com" required>
                            <div class="invalid-feedback">
                                Por favor, insira um email válido.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="telefone" class="form-label">
                                <i class="fas fa-phone"></i> Contato Principal *
                            </label>
                            <input type="text" class="form-control" id="telefone" name="telefone" 
                                   placeholder="(00) 00000-0000" maxlength="15" required>
                            <div class="invalid-feedback">
                                Por favor, insira um telefone válido.
                            </div>
                        </div>
                    </div>

                    <!-- Dados do Agente -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-user"></i> Dados do Agente
                            </h6>
                        </div>
                        
                        <div class="col-md-12 mb-3">
                            <label for="nomeCompletoAgente" class="form-label">
                                <i class="fas fa-user"></i> Nome Completo do Agente *
                            </label>
                            <input type="text" class="form-control" id="nomeCompletoAgente" name="nome_completo_agente" 
                                   placeholder="Nome completo do responsável" required>
                            <div class="invalid-feedback">
                                Por favor, insira o nome completo do agente.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="cpfResponsavel" class="form-label">
                                <i class="fas fa-id-badge"></i> CPF do Agente *
                            </label>
                            <input type="text" class="form-control" id="cpfResponsavel" name="cpf_responsavel" 
                                   placeholder="000.000.000-00" maxlength="14" required>
                            <div class="invalid-feedback">
                                Por favor, insira um CPF válido.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="dataNascimento" class="form-label">
                                <i class="fas fa-calendar"></i> Data de Nascimento *
                            </label>
                            <input type="date" class="form-control" id="dataNascimento" name="data_nascimento" required>
                            <div class="invalid-feedback">
                                Por favor, selecione a data de nascimento.
                            </div>
                        </div>
                    </div>

                    <!-- Configurações de Acesso -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                <i class="fas fa-key"></i> Configurações de Acesso
                            </h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="username" class="form-label">
                                <i class="fas fa-user"></i> Nome de Usuário *
                            </label>
                            <input type="text" class="form-control" id="username" name="username" 
                                   placeholder="usuario.login" required>
                            <div class="invalid-feedback">
                                Por favor, insira um nome de usuário.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="senha" class="form-label">
                                <i class="fas fa-lock"></i> Senha Inicial *
                            </label>
                            <input type="password" class="form-control" id="senha" name="senha" 
                                   placeholder="Senha temporária" required>
                            <div class="invalid-feedback">
                                Por favor, defina uma senha inicial.
                            </div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isAdministrador" name="is_administrador">
                                <label class="form-check-label" for="isAdministrador">
                                    <i class="fas fa-shield-alt text-warning"></i> 
                                    <strong>Usuário Administrador</strong>
                                    <small class="d-block" style="color: #000000 !important; font-weight: 600;">Concede acesso total ao sistema</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="row">
                        <div class="col-12 d-flex gap-2 justify-content-end">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('createUserForm').reset()">
                                <i class="fas fa-times"></i> Limpar
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Criar Usuário
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Seção: Usuários Bloqueados -->
    <div id="bloqueados-section" class="management-content">
        <div class="card border-0 shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #f5af19, #f12711); color: white;">
                <h5 class="mb-0">
                    <i class="fas fa-unlock-alt me-2"></i>Controle de Usuários Bloqueados
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-3">
                    <i class="fas fa-info-circle me-2 text-info"></i>
                    <strong>Sistema de Proteção:</strong> Usuários são bloqueados automaticamente após <span class="badge bg-danger">3 tentativas incorretas</span> de login. 
                    Use esta ferramenta para gerenciar e desbloquear contas.
                </p>
                
                {% if bloqueados %}
                    <div class="alert alert-warning border-warning mb-4" role="alert">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-exclamation-triangle me-3" style="font-size: 2rem; color: #856404;"></i>
                            <div class="flex-grow-1">
                                <h5 class="alert-heading mb-2">
                                    <i class="fas fa-lock me-2"></i>Usuários Bloqueados Detectados
                                </h5>
                                <p class="mb-3">Os seguintes usuários estão atualmente bloqueados por excederem o limite de tentativas de login:</p>
                                
                                <!-- Lista de Usuários Bloqueados -->
                                <div class="list-group">
                                    {% for u in bloqueados %}
                                    <div class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center" 
                                                 style="width: 40px; height: 40px; flex-shrink: 0;">
                                                <i class="fas fa-user-lock"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0 fw-bold text-dark">{{ u }}</h6>
                                                <small class="text-muted">
                                                    <i class="fas fa-clock me-1"></i>Bloqueado por excesso de tentativas
                                                </small>
                                            </div>
                                        </div>
                                        <form method="post" action="{% url 'linhas:desbloquear_usuario' %}" style="margin: 0;">
                                            {% csrf_token %}
                                            <input type="hidden" name="username" value="{{ u }}">
                                            <button type="submit" class="btn btn-sm btn-success" title="Desbloquear {{ u }}">
                                                <i class="fas fa-unlock me-1"></i>Desbloquear
                                            </button>
                                        </form>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <div class="mt-3 p-3 bg-light rounded">
                                    <small class="text-muted">
                                        <i class="fas fa-lightbulb me-1 text-warning"></i>
                                        <strong>Dica:</strong> Após desbloquear, oriente o usuário a usar a senha correta. 
                                        Três novas tentativas incorretas resultarão em novo bloqueio automático.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-success border-success mb-4" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check-circle me-3" style="font-size: 2rem; color: #155724;"></i>
                            <div>
                                <h5 class="alert-heading mb-2">
                                    <i class="fas fa-shield-check me-2"></i>Sistema Seguro
                                </h5>
                                <p class="mb-0">
                                    Nenhum usuário está bloqueado no momento. Todos os acessos estão normalizados e funcionando corretamente.
                                </p>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Formulário Manual de Desbloqueio -->
                <div class="card border-primary mt-4">
                    <div class="card-header bg-primary bg-opacity-10">
                        <h6 class="mb-0">
                            <i class="fas fa-unlock-alt me-2"></i>Desbloqueio Manual
                        </h6>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-3">
                            <i class="fas fa-info-circle me-1"></i>
                            Use este formulário para desbloquear um usuário específico digitando exatamente o nome de usuário.
                        </p>
                        <form method="post" action="{% url 'linhas:desbloquear_usuario' %}" class="row g-3">
                            {% csrf_token %}
                            <div class="col-md-8">
                                <label for="unlockUsername" class="form-label">
                                    <i class="fas fa-user me-1"></i>Nome de Usuário
                                </label>
                                <input type="text" id="unlockUsername" name="username" 
                                       class="form-control" 
                                       placeholder="Digite o nome do usuário bloqueado" 
                                       required 
                                       autocomplete="off">
                                <div class="form-text">
                                    Digite exatamente o nome de usuário como foi cadastrado no sistema
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="fas fa-unlock me-2"></i>Desbloquear Usuário
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Estatísticas -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card bg-danger bg-opacity-10 border-danger">
                            <div class="card-body text-center">
                                <i class="fas fa-user-lock fa-2x text-danger mb-2"></i>
                                <h3 class="mb-1 text-danger">{{ bloqueados|length|default:0 }}</h3>
                                <small class="text-muted">Usuários Bloqueados</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-warning bg-opacity-10 border-warning">
                            <div class="card-body text-center">
                                <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                                <h3 class="mb-1 text-warning">3</h3>
                                <small class="text-muted">Tentativas Máximas</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-info bg-opacity-10 border-info">
                            <div class="card-body text-center">
                                <i class="fas fa-shield-alt fa-2x text-info mb-2"></i>
                                <h3 class="mb-1 text-info">Auto</h3>
                                <small class="text-muted">Bloqueio Automático</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Seção: Alterar Senhas -->
    <div id="senhas-section" class="management-content">
        <div class="card border-0 shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                <h5 class="mb-0">
                    <i class="fas fa-key me-2"></i>Alterar Senhas de Usuários
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h6 class="text-muted mb-0">Redefinir senhas de usuários do sistema</h6>
                    </div>
                    <a href="{% url 'linhas:alterar_senhas' %}" class="btn btn-danger">
                        <i class="fas fa-external-link-alt me-2"></i>Acessar Gerenciamento de Senhas
                    </a>
                </div>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> A alteração de senhas é uma operação sensível. Certifique-se de ter as permissões adequadas antes de prosseguir.
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card border-warning">
                            <div class="card-body">
                                <i class="fas fa-shield-alt fa-3x text-warning mb-3"></i>
                                <h6>Segurança</h6>
                                <p class="text-muted small">Senhas devem ter no mínimo 8 caracteres com letras e números</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info">
                            <div class="card-body">
                                <i class="fas fa-history fa-3x text-info mb-3"></i>
                                <h6>Histórico</h6>
                                <p class="text-muted small">Todas as alterações são registradas no sistema</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Container Branco com Abas -->
<div class="config-white-container">
        <div class="tab-content tab-content-area" id="configTabsContent">
            
            <!-- Aba Linhas -->
            <div class="tab-pane fade show active" id="linhas-content" role="tabpanel">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <i class="fas fa-phone" style="font-size: 1.5rem;"></i>
                    <h5 style="margin: 0; font-weight: 600;">Configurações de Linhas</h5>
                </div>
                
                <p style="color: #6c757d; margin-bottom: 2rem;">
                    Configure parâmetros relacionados ao gerenciamento de linhas telefônicas
                </p>
                
                <div class="development-alert">
                    <i class="fas fa-exclamation-circle"></i>
                    <span><strong>Em desenvolvimento:</strong> Configurações de linhas serão implementadas em breve.</span>
                </div>
                
                <!-- Importar Linhas -->
                <div style="margin-bottom: 2.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-file-upload" style="font-size: 1.2rem; color: #28a745;"></i>
                        <h6 style="margin: 0; font-weight: 600;">Importar Linhas</h6>
                        <span class="status-badge active">Ativo</span>
                    </div>
                    <p style="color: #6c757d; font-size: 0.95rem; margin-bottom: 1rem;">
                        Importe linhas em lote através de arquivos Excel ou CSV
                    </p>
                    
                    <div class="card border-success" style="margin-bottom: 1rem;">
                        <div class="card-body">
                            <form id="importLinhasForm" enctype="multipart/form-data" style="margin-bottom: 1rem;">
                                {% csrf_token %}
                                
                                <div class="row align-items-end">
                                    <div class="col-md-4 mb-3">
                                        <label for="empresa_select" class="form-label">
                                            <i class="fas fa-building me-1"></i>Empresa de Destino *
                                        </label>
                                        <select name="empresa_id" id="empresa_select" class="form-select" required>
                                            <option value="">Selecione uma empresa...</option>
                                            <!-- Será preenchido via AJAX -->
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label for="arquivo_import" class="form-label">
                                            <i class="fas fa-file-excel me-1"></i>Arquivo de Linhas *
                                        </label>
                                        <input type="file" name="arquivo_linhas" id="arquivo_import" 
                                               class="form-control" accept=".xlsx,.xls,.csv" required>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <button type="button" id="btnImportarLinhas" class="btn btn-success w-100">
                                            <i class="fas fa-upload me-1"></i>Importar Linhas
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-text">
                                    <strong>Formatos aceitos:</strong> Excel (.xlsx, .xls) ou CSV<br>
                                    <strong>Colunas esperadas:</strong> Numero, ICCID, Tipo_Plano, Valor_Plano, RP, Acao
                                </div>
                            </form>
                            
                            <!-- Preview do arquivo -->
                            <div id="preview_import_linhas" style="display: none;">
                                <hr>
                                <h6><i class="fas fa-eye me-2"></i>Preview do Arquivo</h6>
                                <div id="preview_content"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Dica:</strong> Use o <a href="{% url 'linhas:cadastro_empresa' %}" class="alert-link">cadastro de empresa</a> 
                        para importar linhas automaticamente ao criar uma nova empresa.
                    </div>
                </div>
                
                <!-- Parâmetros Gerais -->
                <div style="margin-bottom: 2.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-cogs" style="font-size: 1.2rem;"></i>
                        <h6 style="margin: 0; font-weight: 600;">Parâmetros Gerais</h6>
                    </div>
                    <p style="color: #6c757d; font-size: 0.95rem; margin-bottom: 1rem;">
                        Configurações globais do sistema de linhas
                    </p>
                    <button class="btn btn-outline-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-external-link-alt"></i> Configurar
                    </button>
                </div>
                
                <!-- Relatórios -->
                <div style="margin-bottom: 2.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-chart-line" style="font-size: 1.2rem;"></i>
                        <h6 style="margin: 0; font-weight: 600;">Relatórios</h6>
                    </div>
                    <p style="color: #6c757d; font-size: 0.95rem; margin-bottom: 1rem;">
                        Configurações de relatórios e exportações
                    </p>
                    <button class="btn btn-outline-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-external-link-alt"></i> Configurar
                    </button>
                </div>
            </div>

            <!-- Aba Usuários -->
            <div class="tab-pane fade" id="usuarios-content" role="tabpanel">
                <div class="section-title" id="usuarios-section">
                    <i class="fas fa-users"></i>
                    Gerenciamento de Usuários
                </div>
                
                <p class="section-description">
                    Gerencie usuários do sistema e segurança de acesso.
                </p>
                
                <div class="d-flex gap-2 mb-4">
                    <span class="status-badge active">Ativo</span>
                    <button class="btn btn-primary" onclick="document.getElementById('user-management-section').scrollIntoView({behavior: 'smooth'})">
                        <i class="fas fa-users-cog me-2"></i>Gerenciar Usuários
                    </button>
                    <button class="btn btn-success" onclick="document.getElementById('createUserForm').scrollIntoView({behavior: 'smooth'})">
                        <i class="fas fa-user-plus me-2"></i>Criar Novo Usuário
                    </button>
                    <button class="btn btn-warning" onclick="document.getElementById('usuarios-section').scrollIntoView({behavior: 'smooth'})">
                        <i class="fas fa-unlock-alt me-2"></i>Usuários Bloqueados
                    </button>
                </div>
                        
                <!-- Seção Desbloquear Usuários -->
                <div class="form-section">
                    <h6 class="form-section-header">
                        <i class="fas fa-shield-alt me-2"></i>Controle de Segurança - Usuários Bloqueados
                    </h6>
                    
                    <p class="mb-3">
                        <i class="fas fa-info-circle me-2 text-info"></i>
                        <strong>Sistema de Proteção:</strong> Usuários são bloqueados automaticamente após <span class="badge bg-danger">3 tentativas incorretas</span> de login. 
                        Use esta ferramenta para gerenciar e desbloquear contas.
                    </p>
                    
                    {% if bloqueados %}
                        <div class="alert alert-warning border-warning mb-4" role="alert">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-exclamation-triangle me-3" style="font-size: 2rem; color: #856404;"></i>
                                <div class="flex-grow-1">
                                    <h5 class="alert-heading mb-2">
                                        <i class="fas fa-lock me-2"></i>Usuários Bloqueados Detectados
                                    </h5>
                                    <p class="mb-3">Os seguintes usuários estão atualmente bloqueados por excederem o limite de tentativas de login:</p>
                                    
                                    <!-- Lista de Usuários Bloqueados -->
                                    <div class="list-group">
                                        {% for u in bloqueados %}
                                        <div class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center" 
                                                     style="width: 40px; height: 40px; flex-shrink: 0;">
                                                    <i class="fas fa-user-lock"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-bold text-dark">{{ u }}</h6>
                                                    <small class="text-muted">
                                                        <i class="fas fa-clock me-1"></i>Bloqueado por excesso de tentativas
                                                    </small>
                                                </div>
                                            </div>
                                            <form method="post" action="{% url 'linhas:desbloquear_usuario' %}" style="margin: 0;">
                                                {% csrf_token %}
                                                <input type="hidden" name="username" value="{{ u }}">
                                                <button type="submit" class="btn btn-sm btn-success" title="Desbloquear {{ u }}">
                                                    <i class="fas fa-unlock me-1"></i>Desbloquear
                                                </button>
                                            </form>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    
                                    <div class="mt-3 p-3 bg-light rounded">
                                        <small class="text-muted">
                                            <i class="fas fa-lightbulb me-1 text-warning"></i>
                                            <strong>Dica:</strong> Após desbloquear, oriente o usuário a usar a senha correta. 
                                            Três novas tentativas incorretas resultarão em novo bloqueio automático.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-success border-success mb-4" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle me-3" style="font-size: 2rem; color: #155724;"></i>
                                <div>
                                    <h5 class="alert-heading mb-2">
                                        <i class="fas fa-shield-check me-2"></i>Sistema Seguro
                                    </h5>
                                    <p class="mb-0">
                                        Nenhum usuário está bloqueado no momento. Todos os acessos estão normalizados e funcionando corretamente.
                                    </p>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- Formulário Manual de Desbloqueio -->
                    <div class="card border-primary">
                        <div class="card-header bg-primary bg-opacity-10">
                            <h6 class="mb-0">
                                <i class="fas fa-unlock-alt me-2"></i>Desbloqueio Manual
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">
                                <i class="fas fa-info-circle me-1"></i>
                                Use este formulário para desbloquear um usuário específico digitando exatamente o nome de usuário.
                            </p>
                            <form method="post" action="{% url 'linhas:desbloquear_usuario' %}" class="row g-3">
                                {% csrf_token %}
                                <div class="col-md-8">
                                    <label for="unlockUsername" class="form-label">
                                        <i class="fas fa-user me-1"></i>Nome de Usuário
                                    </label>
                                    <input type="text" id="unlockUsername" name="username" 
                                           class="form-control" 
                                           placeholder="Digite o nome do usuário bloqueado" 
                                           required 
                                           autocomplete="off">
                                    <div class="form-text">
                                        Digite exatamente o nome de usuário como foi cadastrado no sistema
                                    </div>
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <button type="submit" class="btn btn-warning w-100">
                                        <i class="fas fa-unlock me-2"></i>Desbloquear Usuário
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Estatísticas e Informações -->
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="card bg-danger bg-opacity-10 border-danger">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-lock fa-2x text-danger mb-2"></i>
                                    <h3 class="mb-1 text-danger">{{ bloqueados|length|default:0 }}</h3>
                                    <small class="text-muted">Usuários Bloqueados</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-warning bg-opacity-10 border-warning">
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                                    <h3 class="mb-1 text-warning">3</h3>
                                    <small class="text-muted">Tentativas Máximas</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-info bg-opacity-10 border-info">
                                <div class="card-body text-center">
                                    <i class="fas fa-shield-alt fa-2x text-info mb-2"></i>
                                    <h3 class="mb-1 text-info">Auto</h3>
                                    <small class="text-muted">Bloqueio Automático</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                        <!-- Formulário de Criação de Usuário -->
                        <div class="card border-success mb-4">
                            <div class="card-header bg-success bg-opacity-10">
                                <h6 class="mb-0"><i class="fas fa-user-plus"></i> Criar Novo Usuário</h6>
                            </div>
                            <div class="card-body">
                                <form id="createUserForm" method="post" action="{% url 'linhas:criar_usuario_empresa' %}" class="needs-validation" novalidate>
                                    {% csrf_token %}
                                    
                                    <!-- Área de Mensagens -->
                                    <div id="messageArea" class="alert alert-dismissible fade show d-none" role="alert">
                                        <span id="messageText"></span>
                                        <button type="button" class="btn-close" onclick="hideMessage()"></button>
                                    </div>
                                    
                                    <!-- Dados da Empresa -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-building"></i> Dados da Empresa
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="cnpj" class="form-label">
                                                <i class="fas fa-id-card"></i> CNPJ *
                                            </label>
                                            <input type="text" class="form-control" id="cnpj" name="cnpj" 
                                                   placeholder="00.000.000/0000-00" maxlength="18" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um CNPJ válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="razaoSocial" class="form-label">
                                                <i class="fas fa-building"></i> Razão Social *
                                            </label>
                                            <input type="text" class="form-control" id="razaoSocial" name="razao_social" 
                                                   placeholder="Nome da empresa" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira a razão social.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="nomeFantasia" class="form-label">
                                                <i class="fas fa-store"></i> Nome Fantasia
                                            </label>
                                            <input type="text" class="form-control" id="nomeFantasia" name="nome_fantasia" 
                                                   placeholder="Nome fantasia (opcional)">
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="endereco" class="form-label">
                                                <i class="fas fa-map-marker-alt"></i> Endereço *
                                            </label>
                                            <input type="text" class="form-control" id="endereco" name="endereco" 
                                                   placeholder="Endereço completo" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira o endereço.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dados de Contato -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-phone"></i> Dados de Contato
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">
                                                <i class="fas fa-envelope"></i> Email *
                                            </label>
                                            <input type="email" class="form-control" id="email" name="email" 
                                                   placeholder="email@empresa.com" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um email válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="telefone" class="form-label">
                                                <i class="fas fa-phone"></i> Contato Principal *
                                            </label>
                                            <input type="text" class="form-control" id="telefone" name="telefone" 
                                                   placeholder="(00) 00000-0000" maxlength="15" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um telefone válido.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dados do Agente -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-user"></i> Dados do Agente
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-12 mb-3">
                                            <label for="nomeCompletoAgente" class="form-label">
                                                <i class="fas fa-user"></i> Nome Completo do Agente *
                                            </label>
                                            <input type="text" class="form-control" id="nomeCompletoAgente" name="nome_completo_agente" 
                                                   placeholder="Nome completo do responsável" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira o nome completo do agente.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="cpfResponsavel" class="form-label">
                                                <i class="fas fa-id-badge"></i> CPF do Agente *
                                            </label>
                                            <input type="text" class="form-control" id="cpfResponsavel" name="cpf_responsavel" 
                                                   placeholder="000.000.000-00" maxlength="14" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um CPF válido.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="dataNascimento" class="form-label">
                                                <i class="fas fa-calendar"></i> Data de Nascimento *
                                            </label>
                                            <input type="date" class="form-control" id="dataNascimento" name="data_nascimento" required>
                                            <div class="invalid-feedback">
                                                Por favor, selecione a data de nascimento.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Configurações de Acesso -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <h6 class="text-primary border-bottom pb-2 mb-3">
                                                <i class="fas fa-key"></i> Configurações de Acesso
                                            </h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">
                                                <i class="fas fa-user"></i> Nome de Usuário *
                                            </label>
                                            <input type="text" class="form-control" id="username" name="username" 
                                                   placeholder="usuario.login" required>
                                            <div class="invalid-feedback">
                                                Por favor, insira um nome de usuário.
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="senha" class="form-label">
                                                <i class="fas fa-lock"></i> Senha Inicial *
                                            </label>
                                            <input type="password" class="form-control" id="senha" name="senha" 
                                                   placeholder="Senha temporária" required>
                                            <div class="invalid-feedback">
                                                Por favor, defina uma senha inicial.
                                            </div>
                                        </div>
                                        
                                        <div class="col-12 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="isAdministrador" name="is_administrador">
                                                <label class="form-check-label" for="isAdministrador">
                                                    <i class="fas fa-shield-alt text-warning"></i> 
                                                    <strong>Usuário Administrador</strong>
                                                    <small class="d-block" style="color: #000000 !important; font-weight: 600;">Concede acesso total ao sistema</small>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Botões de Ação -->
                                    <div class="row">
                                        <div class="col-12 d-flex gap-2 justify-content-end">
                                            <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                                <i class="fas fa-times"></i> Cancelar
                                            </button>
                                            <button type="submit" class="btn btn-success">
                                                <i class="fas fa-save"></i> Criar Usuário
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                <!-- Seção de Gerenciamento de Usuários -->
                <div id="user-management-section" class="mt-5 pt-4">
                    <h5 class="mb-4">
                        <i class="fas fa-users-cog me-2 text-primary"></i>
                        Ações de Gerenciamento
                    </h5>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6 mb-3">
                        <div class="feature-card active">
                            <div class="feature-icon success">
                                <i class="fas fa-list"></i>
                            </div>
                            <h4 class="feature-title">Listar Usuários</h4>
                            <p class="feature-description">Visualizar todos os usuários cadastrados</p>
                            <a href="{% url 'linhas:listar_usuarios_empresa' %}" class="btn-clean success">
                                <i class="fas fa-eye"></i> Visualizar
                            </a>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="feature-card active">
                            <div class="feature-icon primary">
                                <i class="fas fa-key"></i>
                            </div>
                            <h4 class="feature-title">Alterar Senhas</h4>
                            <p class="feature-description">Redefinir senhas de usuários</p>
                            <a href="{% url 'linhas:alterar_senhas' %}" class="btn-clean primary">
                                <i class="fas fa-key"></i> Gerenciar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Protocolos -->
            <div class="tab-pane fade" id="protocolo-content" role="tabpanel">
                <div class="section-title" id="protocolos-section">
                    <i class="fas fa-clipboard-list"></i>
                    Gerenciamento de Protocolos
                </div>
                
                <p class="section-description">
                    Configure parâmetros, status, prazos e automações para o sistema de protocolos.
                </p>
                
                <span class="status-badge development">Em Desenvolvimento</span>
                
                <div class="config-alert info">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-3" style="font-size: 1.5rem;"></i>
                        <div>
                            <strong>Configurações Avançadas em Desenvolvimento</strong><br>
                            <span>As funcionalidades completas de configuração de protocolos estarão disponíveis em breve.</span>
                        </div>
                    </div>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon warning">
                                        <i class="fas fa-cogs"></i>
                                    </div>
                                    <h6 class="feature-title">Status de Protocolos</h6>
                                </div>
                                <p class="feature-description">Configure e gerencie todos os status disponíveis para classificação de protocolos</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-edit"></i>Configurar Status
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon info">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <h6 class="feature-title">Prazos e SLA</h6>
                                </div>
                                <p class="feature-description">Defina prazos padrão de atendimento e configurações de SLA por tipo de protocolo</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-calendar"></i>Definir Prazos
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon primary">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <h6 class="feature-title">Notificações</h6>
                                </div>
                                <p class="feature-description">Configure alertas automáticos, lembretes e notificações por email ou SMS</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-bell"></i>Configurar Alertas
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon success">
                                        <i class="fas fa-archive"></i>
                                    </div>
                                    <h6 class="feature-title">Arquivamento</h6>
                                </div>
                                <p class="feature-description">Configure regras automáticas de arquivamento e retenção de protocolos antigos</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-folder"></i>Gerenciar Arquivo
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon danger">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h6 class="feature-title">Relatórios</h6>
                                </div>
                                <p class="feature-description">Configure relatórios automáticos de performance e estatísticas de protocolos</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-chart-bar"></i>Configurar Relatórios
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon info">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <h6 class="feature-title">Automações</h6>
                                </div>
                                <p class="feature-description">Configure fluxos automatizados e regras de negócio para protocolos</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-cogs"></i>Configurar Fluxos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Associados -->
            <div class="tab-pane fade" id="associados-content" role="tabpanel">
                <div class="section-title" id="associados-section">
                    <i class="fas fa-handshake"></i>
                    Gerenciamento de Associados
                </div>
                
                <p class="section-description">
                    Configure e administre parcerias, associados e estruturas de comissionamento.
                </p>
                
                <span class="status-badge development">Em Desenvolvimento</span>
                
                <div class="config-alert info">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-3" style="font-size: 1.5rem;"></i>
                        <div>
                            <strong>Módulo de Associados em Desenvolvimento</strong><br>
                            <span>O sistema completo de gerenciamento de associados e comissões está sendo desenvolvido.</span>
                        </div>
                    </div>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon success">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <h6 class="feature-title">Cadastrar Associado</h6>
                                </div>
                                <p class="feature-description">Adicione novos associados com dados completos e configurações de parceria</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-plus"></i>Novo Associado
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon primary">
                                        <i class="fas fa-list"></i>
                                    </div>
                                    <h6 class="feature-title">Listar Associados</h6>
                                </div>
                                <p class="feature-description">Visualize, edite e gerencie todos os associados cadastrados no sistema</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-eye"></i>Gerenciar Associados
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon warning">
                                        <i class="fas fa-percent"></i>
                                    </div>
                                    <h6 class="feature-title">Comissões</h6>
                                </div>
                                <p class="feature-description">Configure percentuais, regras e estruturas de comissionamento por associado</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-calculator"></i>Configurar Comissões
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon info">
                                        <i class="fas fa-file-invoice-dollar"></i>
                                    </div>
                                    <h6 class="feature-title">Relatórios Financeiros</h6>
                                </div>
                                <p class="feature-description">Gere relatórios detalhados de vendas, comissões e performance por associado</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-chart-bar"></i>Gerar Relatórios
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon danger">
                                        <i class="fas fa-handshake"></i>
                                    </div>
                                    <h6 class="feature-title">Contratos</h6>
                                </div>
                                <p class="feature-description">Gerencie contratos, termos de parceria e documentação legal</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-file-contract"></i>Gerenciar Contratos
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="card feature-card disabled-feature">
                            <div class="card-body">
                                <div class="feature-card-header">
                                    <div class="feature-icon success">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h6 class="feature-title">Analytics</h6>
                                </div>
                                <p class="feature-description">Análises avançadas de performance, tendências e métricas de associados</p>
                                <button class="btn btn-feature outline" disabled>
                                    <i class="fas fa-analytics"></i>Ver Análises
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Aba Protocolos -->
            <div class="tab-pane fade" id="protocolo-content" role="tabpanel">
                <div class="section-title">
                    <i class="fas fa-clipboard-list"></i>
                    Gerenciamento de Protocolos
                </div>
                
                <p class="section-description">
                    Configure parâmetros e gerencie protocolos do sistema.
                </p>
                
                <span class="status-badge development">Em Desenvolvimento</span>
                
                <div class="alert alert-info mt-3 mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Em desenvolvimento:</strong> Configurações avançadas de protocolos serão implementadas em breve.
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="feature-card development">
                            <div class="feature-icon warning">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <h4 class="feature-title">Parâmetros de Status</h4>
                            <p class="feature-description">Configurar status disponíveis para protocolos</p>
                            <button class="btn-clean outline" disabled>
                                <i class="fas fa-edit"></i> Configurar
                            </button>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="feature-card development">
                            <div class="feature-icon info">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h4 class="feature-title">Prazos e SLA</h4>
                            <p class="feature-description">Definir prazos padrão de atendimento</p>
                            <button class="btn-clean outline" disabled>
                                <i class="fas fa-calendar"></i> Definir
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Associados -->
            <div class="tab-pane fade" id="associados-content" role="tabpanel">
                <div class="section-title">
                    <i class="fas fa-handshake"></i>
                    Gerenciamento de Associados
                </div>
                
                <p class="section-description">
                    Configure e gerencie informações de associados e parcerias.
                </p>
                
                <span class="status-badge development">Em Desenvolvimento</span>
                
                <div class="alert alert-info mt-3 mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Em desenvolvimento:</strong> Funcionalidades de associados serão implementadas em breve.
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="feature-card development">
                            <div class="feature-icon success">
                                <i class="fas fa-building"></i>
                            </div>
                            <h4 class="feature-title">Cadastrar Associado</h4>
                            <p class="feature-description">Adicionar novos associados ao sistema</p>
                            <button class="btn-clean outline" disabled>
                                <i class="fas fa-plus"></i> Novo Associado
                            </button>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="feature-card development">
                            <div class="feature-icon primary">
                                <i class="fas fa-percent"></i>
                            </div>
                            <h4 class="feature-title">Comissões</h4>
                            <p class="feature-description">Configurar percentuais de comissão</p>
                            <button class="btn-clean outline" disabled>
                                <i class="fas fa-calculator"></i> Configurar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Máscaras de input
function aplicarMascaras() {
    // Máscara CNPJ
    const cnpjInput = document.getElementById('cnpj');
    if (cnpjInput) {
        cnpjInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    // Máscara CPF
    const cpfInput = document.getElementById('cpfResponsavel');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });
    }

    // Máscara Telefone
    const telefoneInput = document.getElementById('telefone');
    if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{4})(\d)/, '$1-$2');
                } else {
                    value = value.replace(/(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                }
            }
            e.target.value = value;
        });
    }
}

// Validações
function validarCNPJ(cnpj) {
    cnpj = cnpj.replace(/[^\d]/g, '');
    
    if (cnpj.length !== 14) return false;
    
    // Elimina CNPJs inválidos conhecidos
    if (/^(\d)\1+$/.test(cnpj)) return false;
    
    // Validação do primeiro dígito
    let soma = 0;
    let peso = 2;
    for (let i = 11; i >= 0; i--) {
        soma += parseInt(cnpj.charAt(i)) * peso;
        peso = peso === 9 ? 2 : peso + 1;
    }
    
    let digito = soma % 11;
    digito = digito < 2 ? 0 : 11 - digito;
    
    if (parseInt(cnpj.charAt(12)) !== digito) return false;
    
    // Validação do segundo dígito
    soma = 0;
    peso = 2;
    for (let i = 12; i >= 0; i--) {
        soma += parseInt(cnpj.charAt(i)) * peso;
        peso = peso === 9 ? 2 : peso + 1;
    }
    
    digito = soma % 11;
    digito = digito < 2 ? 0 : 11 - digito;
    
    return parseInt(cnpj.charAt(13)) === digito;
}

function validarCPF(cpf) {
    cpf = cpf.replace(/[^\d]/g, '');
    
    if (cpf.length !== 11) return false;
    
    // Elimina CPFs inválidos conhecidos
    if (/^(\d)\1+$/.test(cpf)) return false;
    
    // Validação do primeiro dígito
    let soma = 0;
    for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf.charAt(i)) * (10 - i);
    }
    let digito = (soma * 10) % 11;
    if (digito === 10) digito = 0;
    if (parseInt(cpf.charAt(9)) !== digito) return false;
    
    // Validação do segundo dígito
    soma = 0;
    for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf.charAt(i)) * (11 - i);
    }
    digito = (soma * 10) % 11;
    if (digito === 10) digito = 0;
    
    return parseInt(cpf.charAt(10)) === digito;
}

// Validação do formulário
function validarFormulario() {
    const form = document.getElementById('createUserForm');
    if (!form) return;

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        let isValid = true;
        
        // Validar CNPJ
        const cnpj = document.getElementById('cnpj').value;
        if (!validarCNPJ(cnpj)) {
            document.getElementById('cnpj').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('cnpj').classList.remove('is-invalid');
            document.getElementById('cnpj').classList.add('is-valid');
        }
        
        // Validar CPF
        const cpf = document.getElementById('cpfResponsavel').value;
        if (!validarCPF(cpf)) {
            document.getElementById('cpfResponsavel').classList.add('is-invalid');
            isValid = false;
        } else {
            document.getElementById('cpfResponsavel').classList.remove('is-invalid');
            document.getElementById('cpfResponsavel').classList.add('is-valid');
        }
        
        // Validar campos obrigatórios
        const requiredFields = form.querySelectorAll('[required]');
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
            }
        });
        
        form.classList.add('was-validated');
        
        if (isValid) {
            // Enviar dados via AJAX
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message, 'success');
                    resetForm();
                } else {
                    showMessage(data.error || 'Erro ao criar usuário', 'error');
                }
            })
            .catch(error => {
                showMessage('Erro de conexão ao criar usuário', 'error');
                console.error('Error:', error);
            });
        }
    });
}

// Função para resetar o formulário
function resetForm() {
    const form = document.getElementById('createUserForm');
    if (form) {
        form.reset();
        form.classList.remove('was-validated');
        
        // Remover classes de validação
        const inputs = form.querySelectorAll('.form-control');
        inputs.forEach(input => {
            input.classList.remove('is-valid', 'is-invalid');
        });
        
        // Limpar checkbox
        const checkbox = document.getElementById('isAdministrador');
        if (checkbox) {
            checkbox.checked = false;
        }
    }
}

// Função para mostrar mensagens
function showMessage(message, type) {
    const messageArea = document.getElementById('messageArea');
    const messageText = document.getElementById('messageText');
    
    if (messageArea && messageText) {
        // Remover classes anteriores
        messageArea.className = 'alert alert-dismissible fade show';
        
        // Adicionar classe baseada no tipo
        if (type === 'success') {
            messageArea.classList.add('alert-success');
            messageText.innerHTML = '<i class="fas fa-check-circle"></i> ' + message;
        } else {
            messageArea.classList.add('alert-danger');
            messageText.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + message;
        }
        
        // Mostrar mensagem
        messageArea.classList.remove('d-none');
        
        // Auto-hide após 8 segundos para sucesso, manter erro
        if (type === 'success') {
            setTimeout(() => {
                hideMessage();
            }, 8000);
        }
    }
}

// Função para esconder mensagem
function hideMessage() {
    const messageArea = document.getElementById('messageArea');
    if (messageArea) {
        messageArea.classList.add('d-none');
    }
}

// Funções de UI aprimoradas
function initConfigurationUI() {
    // Animações de entrada para cards
    const featureCards = document.querySelectorAll('.feature-card');
    featureCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Efeitos de hover personalizados
    featureCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        });
    });
    
    // Indicadores de progresso para funcionalidades
    updateProgressIndicators();
}

function updateProgressIndicators() {
    const activeFeatures = document.querySelectorAll('.feature-card.active-feature').length;
    const totalFeatures = document.querySelectorAll('.feature-card').length;
    const developmentFeatures = document.querySelectorAll('.feature-card.disabled-feature').length;
    
    // Atualizar contadores se existirem
    const progressElements = document.querySelectorAll('[data-progress]');
    progressElements.forEach(el => {
        const type = el.getAttribute('data-progress');
        switch(type) {
            case 'active':
                el.textContent = activeFeatures;
                break;
            case 'total':
                el.textContent = totalFeatures;
                break;
            case 'development':
                el.textContent = developmentFeatures;
                break;
        }
    });
}

// Melhorias na navegação das abas
function enhanceTabNavigation() {
    const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
    tabs.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function(e) {
            const target = e.target.getAttribute('data-bs-target');
            const tabPane = document.querySelector(target);
            
            // Animação de fade-in personalizada
            if (tabPane) {
                tabPane.style.opacity = '0';
                tabPane.style.transform = 'translateX(20px)';
                
                setTimeout(() => {
                    tabPane.style.transition = 'all 0.3s ease';
                    tabPane.style.opacity = '1';
                    tabPane.style.transform = 'translateX(0)';
                }, 50);
            }
            
            // Atualizar URL sem recarregar página
            const tabId = e.target.id.replace('-tab', '');
            history.replaceState(null, null, '#' + tabId);
        });
    });
}

// Funções para importação de linhas
function carregarEmpresas() {
    const select = document.getElementById('empresa_select');
    if (!select) return;
    
    // Fazer requisição para buscar empresas
    fetch('/linhas/buscar-clientes/')
        .then(response => response.json())
        .then(data => {
            // Limpar opções existentes (exceto a primeira)
            select.innerHTML = '<option value="">Selecione uma empresa...</option>';
            
            // Adicionar empresas
            data.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = `${empresa.empresa} - ${empresa.cnpj}`;
                select.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Erro ao carregar empresas:', error);
            select.innerHTML = '<option value="">Erro ao carregar empresas</option>';
        });
}

function previewArquivoImport() {
    const arquivo = document.getElementById('arquivo_import').files[0];
    const previewDiv = document.getElementById('preview_import_linhas');
    const previewContent = document.getElementById('preview_content');
    
    if (!arquivo) {
        previewDiv.style.display = 'none';
        return;
    }
    
    previewContent.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Processando arquivo...</div>';
    previewDiv.style.display = 'block';
    
    // Usar AJAX para processar arquivo no servidor
    const formData = new FormData();
    formData.append('arquivo', arquivo);
    
    fetch('/linhas/preview-arquivo-linhas/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            mostrarPreviewImport(data.linhas, data.arquivo_nome);
        } else {
            previewContent.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-times-circle me-1"></i>
                    ${data.error}
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        previewContent.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-times-circle me-1"></i>
                Erro ao processar arquivo. Tente novamente.
            </div>
        `;
    });
}

function mostrarPreviewImport(linhas, nomeArquivo) {
    const previewContent = document.getElementById('preview_content');
    
    if (!linhas || linhas.length === 0) {
        previewContent.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-1"></i>
                Nenhuma linha encontrada no arquivo.
            </div>
        `;
        return;
    }
    
    let html = `
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <strong>${linhas.length} linha${linhas.length > 1 ? 's' : ''} encontrada${linhas.length > 1 ? 's' : ''}</strong>
                <br><small style="color: #000000 !important; font-weight: 600;">Arquivo: ${nomeArquivo}</small>
            </div>
        </div>
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-sm table-bordered">
                <thead class="table-light sticky-top">
                    <tr>
                        <th>Número</th>
                        <th>ICCID</th>
                        <th>Plano</th>
                        <th>Valor</th>
                        <th>RP</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    // Mostrar todas as linhas no preview das configurações
    linhas.forEach(linha => {
        html += `
            <tr>
                <td>${linha.numero || ''}</td>
                <td>${linha.iccid || ''}</td>
                <td>${linha.tipo_plano || ''}</td>
                <td>${linha.valor_plano || ''}</td>
                <td>${linha.rp || ''}</td>
                <td>${linha.acao || 'ESTOQUE'}</td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
        <div class="mt-2">
            <small class="text-success">
                <i class="fas fa-check-circle me-1"></i>
                Arquivo válido. Pronto para importação.
            </small>
        </div>
    `;
    
    previewContent.innerHTML = html;
}

function importarLinhas() {
    const empresaSelect = document.getElementById('empresa_select');
    const arquivoInput = document.getElementById('arquivo_import');
    const btnImportar = document.getElementById('btnImportarLinhas');
    
    // Validações
    if (!empresaSelect.value) {
        alert('Por favor, selecione uma empresa.');
        empresaSelect.focus();
        return;
    }
    
    if (!arquivoInput.files[0]) {
        alert('Por favor, selecione um arquivo.');
        arquivoInput.focus();
        return;
    }
    
    // Desabilitar botão e mostrar loading
    const originalText = btnImportar.innerHTML;
    btnImportar.disabled = true;
    btnImportar.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Importando...';
    
    // Preparar FormData
    const formData = new FormData();
    formData.append('empresa_id', empresaSelect.value);
    formData.append('lista_estoque', arquivoInput.files[0]);
    
    // Enviar requisição
    fetch('/linhas/processar-lista-estoque/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: formData
    })
    .then(response => {
        if (response.ok) {
            return response.text();
        }
        throw new Error('Erro na importação');
    })
    .then(data => {
        // Mostrar mensagem de sucesso
        alert('Linhas importadas com sucesso!');
        
        // Limpar formulário
        document.getElementById('importLinhasForm').reset();
        document.getElementById('preview_import_linhas').style.display = 'none';
        
        // Recarregar página para mostrar mensagens do Django
        window.location.reload();
    })
    .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao importar linhas. Tente novamente.');
    })
    .finally(() => {
        // Restaurar botão
        btnImportar.disabled = false;
        btnImportar.innerHTML = originalText;
    });
}

// Inicialização quando DOM carregado
document.addEventListener('DOMContentLoaded', function() {
    // Aplicar estilos iniciais
    document.querySelectorAll('.feature-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.3s ease';
    });
    
    // Inicializar funções
    aplicarMascaras();
    validarFormulario();
    initConfigurationUI();
    enhanceTabNavigation();
    
    // Carregar empresas para o select
    carregarEmpresas();
    
    // Event listeners para importação de linhas
    const arquivoInput = document.getElementById('arquivo_import');
    if (arquivoInput) {
        arquivoInput.addEventListener('change', previewArquivoImport);
    }
    
    const btnImportar = document.getElementById('btnImportarLinhas');
    if (btnImportar) {
        btnImportar.addEventListener('click', importarLinhas);
    }
    
    // Verificar hash na URL para ativação de aba
    if (window.location.hash) {
        const hash = window.location.hash.substring(1);
        const tabButton = document.getElementById(hash + '-tab');
        if (tabButton) {
            const tab = new bootstrap.Tab(tabButton);
            tab.show();
        }
    }
});

// Smooth scrolling para elementos internos
document.addEventListener('click', function(e) {
    if (e.target.matches('a[href^="#"]')) {
        e.preventDefault();
        const target = document.querySelector(e.target.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    }
});
</script>
{% endblock %}
